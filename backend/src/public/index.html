<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>ft_transcendence</title>
	<!-- <link href="../../public/css/output.css" rel="stylesheet"> -->
	<script type="module" src="/app.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css">
	<link rel="stylesheet" href="/css/output.css">
	<style>
		.view { display: none; }
		.active { display: block; }
	</style>
</head>
<body class="relative bg-purple-900 text-white">
	<main class="flex-grow">

	<!-- INDEX VIEW: Centered using flex -->
	<section id="index-view" class="view active min-h-screen flex flex-col items-center justify-center">
		<!-- Hamburger Button & Flyout Menu (always visible at top right) -->
		<button id="menuButton" class="absolute top-6 right-6 w-10 h-10 rounded-full bg-purple-700 hover:bg-purple-600 flex items-center justify-center text-2xl leading-none cursor-pointer" title="More Information">
			‚ò∞
		</button>
		<div id="flyoutMenu" class="hidden fixed top-6 right-6 bottom-16 w-96 overflow-y-auto bg-purple-200 text-gray-800 p-6 rounded-lg shadow-lg transition-all duration-200">
			<div class="relative mb-4">
				<h2 class="text-xl font-bold">SETTINGS</h2>
				<button id="closeFlyout" class="absolute top-0 right-0 text-gray-800 hover:text-gray-600 text-2xl font-bold" title="Close">
					&times;
				</button>
			</div>
			<ul class="space-y-4">
				<div class="flex flex-col gap-y-4 mt-10">
					<li class="relative block">
						<div class="absolute bg-green-500 w-full h-full top-2 left-2"></div>
						<a onclick="location.href='/game/new';" id="newGameLink" class="relative block bg-purple-600 text-white px-4 py-2 hover:bg-purple-700">
							New Game
						</a>
					</li>
					<li class="relative block">
						<div class="absolute bg-green-500 w-full h-full top-2 left-2"></div>
						<a id="googleLoginLink" onclick="location.href='/google-login';" class="relative block bg-purple-600 text-white px-4 py-2 hover:bg-purple-700">
							Login to Account
						</a>
					</li>
					<!-- Popover for account actions -->
					<div id="accountPopover" class="absolute hidden flex flex-col bg-white border border-gray-300 rounded shadow p-4 mt-12">
						<button id="existingAccountBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mb-2">
							Login to Existing Account
						</button>
						<button id="newAccountBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
							Create New Account
						</button>
					</div>
				</div>
			</ul>
			<script src="index.js"></script>
		</div>
		<!-- Main Content (Centered) -->
	<div class="flex items-center justify-center min-h-screen">
		<div class="text-center">
			<h1 class="text-6xl font-bold tracking-wide">
				WELCOME T<span class="inline-block align-middle">üèì</span>PONG
			</h1>
			<p class="mt-6 text-lg">
				FOR MORE INFORMATION CLICK ON THE TOP RIGHT Hamburger ICON
			</p>
		</div>
	</div>
	</section>

	<!-- ACCOUNT VIEW -->
	<section id="account-view" class="view">
		<div class="min-h-screen bg-purple-900 text-white flex flex-col">
			<!-- Header: User Info & Actions -->
			<header class="p-4 bg-purple-500 flex justify-between items-center">
				<div class="flex items-center space-x-3">
					<img src="<%= user.image_url %>" alt="User Avatar" class="w-10 h-10 rounded-full border-2 border-purple-600 shadow">
					<div>
						<p id="usernameDisplay" class="font-semibold cursor-pointer"><%= user.username %></p>
						<p class="text-sm text-purple-200"><%= user.email %></p>
					</div>
				</div>
				<nav class="space-x-4">
					<a href="/api/user/<%= user.username %>/edit" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded transition-colors">
						Edit Profile
					</a>
					<a href="/api/user/logout" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded transition-colors">
						Logout
					</a>
				</nav>
			</header>
			<!-- Main Content -->
			<main class="flex-grow flex flex-col items-center justify-center text-center px-4">
				<h1 class="text-6xl font-extrabold mb-8 flex items-center space-x-2">
					<span>PONG</span>
					<span class="text-4xl transform rotate-12">üèì</span>
				</h1>
		<div class="relative">
			<div class="absolute top-2 left-2 w-full h-full bg-green-500 rounded"></div>
			<a href="#singleplayer" id="singlePlayerBtn"
				class="relative block w-full py-3 text-xl bg-purple-600 rounded hover:bg-purple-700 transition-colors text-center">
				SINGLE PLAYER
			</a>
		</div>
		<div class="relative">
			<div class="absolute top-2 left-2 w-full h-full bg-green-500 rounded"></div>
			<a href="#multiplayer" id="multiPlayerBtn"
				class="relative block w-full py-3 text-xl bg-purple-600 rounded hover:bg-purple-700 transition-colors text-center">
				MULTI PLAYER
			</a>
		</div>
		<div class="relative">
			<div class="absolute top-2 left-2 w-full h-full bg-green-500 rounded"></div>
				<a href="#tournament" class="relative block w-full py-3 text-xl bg-purple-600 rounded hover:bg-purple-700 transition-colors text-center">
					TOURNAMENT
				</a>
				</div>
				</div>
			</main>
				<section id="tournament-view" class="view min-h-screen flex flex-col items-center justify-center">
					<h1 class="text-4xl font-bold mb-4">Tournament Registration</h1>
					<form id="tournamentForm" class="w-full max-w-md mb-6">
						<div class="mb-4">
							<label for="tournamentPlayers" class="block text-lg mb-2">Enter Player Aliases (separated by commas)</label>
							<textarea id="tournamentPlayers" name="tournamentPlayers" required class="w-full p-2 rounded text-black"
								rows="3" placeholder="e.g., Alice, Bob, Charlie"></textarea>
						</div>
						<button type="button" id="registerTournamentButton"
							class="w-full py-3 text-xl bg-purple-600 rounded hover:bg-purple-700 transition-colors mb-4">
							Register Tournament
						</button>
					</form>
					<button type="button" id="startTournamentButton"
						class="w-full max-w-md py-3 text-xl bg-green-500 rounded hover:bg-green-600 transition-colors">
						Start Tournament
					</button>
					<button type="button" onclick="location.href='#index'"
						class="mt-4 px-4 py-2 bg-purple-600 rounded hover:bg-purple-700">Back</button>
				</section>
			<!-- User Stats Modal -->
			<div id="userStatsModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
				<div class="bg-purple-200 text-black w-1/2 p-6 rounded relative shadow-lg">
					<button id="closeModalBtn" class="absolute top-2 right-2 text-2xl font-bold text-black hover:text-gray-600">
						&times;
					</button>
					<h2 class="text-xl font-bold mb-6 text-black tracking-wider text-center">
						<%= user.username %> score
					</h2>
					<div class="space-y-4">
						<div class="relative">
							<div class="absolute top-2 left-2 w-full h-full bg-green-500 rounded"></div>
							<div class="relative bg-purple-600 text-white p-3 rounded text-center">
								<p class="font-bold">Total Games</p>
								<p><%= stats.total_games %></p>
							</div>
						</div>
						<div class="relative">
							<div class="absolute top-2 left-2 w-full h-full bg-green-500 rounded"></div>
							<div class="relative bg-purple-600 text-white p-3 rounded text-center">
								<p class="font-bold">Wins</p>
								<p><%= stats.wins %></p>
							</div>
						</div>
						<div class="relative">
							<div class="absolute top-2 left-2 w-full h-full bg-green-500 rounded"></div>
							<div class="relative bg-purple-600 text-white p-3 rounded text-center">
								<p class="font-bold">Losses</p>
								<p><%= stats.losses %></p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<script src="/account.js"></script>
		</section>

		<!-- CREATE PROFILE VIEW -->
		<section id="createProfile-view" class="view">
			<div class="min-h-screen bg-purple-900 text-white flex items-center justify-center">
				<div class="max-w-md w-full bg-purple-800 p-6 rounded shadow">
					<h1 class="text-3xl font-bold mb-4 text-center">Create New Profile</h1>
					<div class="text-center mb-6">
						<p class="mb-2">Hello <%= email %>!</p>
						<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR81iX4Mo49Z3oCPSx-GtgiMAkdDop2uVmVvw&s" alt="Avatar" class="mx-auto w-20 h-20 rounded-full border-2 border-purple-600 shadow">
					</div>
					<form class="space-y-4" action="/api/user" method="post">
						<div>
							<label for="username" class="block mb-1 font-semibold">Choose a Username</label>
							<input type="text" id="username" name="username" class="w-full px-3 py-2 text-black rounded focus:outline-none" placeholder="Enter your username" required>
						</div>
						<p class="text-red-400"><%= status %></p>
						<button type="submit" class="w-full py-2 bg-green-500 hover:bg-green-600 text-black font-semibold rounded transition-colors">
							Create
						</button>
					</form>
				</div>
			</div>
			<script src="/createProfile.js"></script>
		</section>

		<!-- EDIT PROFILE VIEW -->
		<section id="editProfile-view" class="view">
			<div class="min-h-screen bg-purple-900 text-white flex items-center justify-center p-4">
				<div class="max-w-lg w-full space-y-8">
					<div class="bg-purple-500 p-6 rounded shadow">
						<h1 class="text-3xl font-bold mb-4 text-center">Edit Profile</h1>
						<div class="flex flex-col items-center mb-6">
							<img src="<%= user.image_url %>" alt="Avatar" class="w-24 h-24 rounded-full border-2 border-purple-600 shadow">
						</div>
						<form class="space-y-4" action="#multiplayer" method="post" enctype="multipart/form-data">
							<div>
								<label for="username" class="block mb-1 font-semibold">Edit Username:</label>
								<input type="text" id="username" name="username" class="w-full px-3 py-2 text-black rounded focus:outline-none" required placeholder="<%= user.username %>">
							</div>
							<div>
								<label for="avatarLink" class="block mb-1 font-semibold">Avatar URL (optional):</label>
								<input type="text" id="avatarLink" name="avatarLink" class="w-full px-3 py-2 text-black rounded focus:outline-none" placeholder="Enter an image URL if you prefer">
							</div>
							<div>
								<label for="avatarFile" class="block mb-1 font-semibold">Or Upload Avatar:</label>
								<input type="file" id="avatarFile" name="avatarFile" accept="image/*" class="w-full px-3 py-2 text-black rounded focus:outline-none">
							</div>
							<p class="text-red-400"><%= status %></p>
							<button type="submit" class="w-full py-2 bg-green-500 hover:bg-green-600 text-black font-semibold rounded transition-colors">
								Save
							</button>
						</form>
					</div>
					<div class="bg-purple-500 p-6 rounded shadow">
						<h2 class="text-xl font-bold mb-4 text-center">DANGER ZONE</h2>
						<form class="flex items-center justify-center" action="/api/user/<%= user.username %>/delete" method="get">
							<button type="submit" class="w-full py-2 bg-red-500 hover:bg-red-600 text-black font-semibold rounded transition-colors">
								Delete Profile
							</button>
						</form>
					</div>
				</div>
			</div>
			<script src="/editProfile.js"></script>
		</section>
	</main>

		<section id="singleplayer-view" class="view flex flex-col items-center justify-center min-h-screen px-4">
			<h1 class="text-4xl font-bold mb-4">Single Player Pong</h1>
			<canvas id="pong" width="800" height="600" class="mb-4"></canvas>
			<!-- You can add additional controls/buttons here -->
			<button onclick="location.href='#account'" class="px-4 py-2 bg-purple-600 rounded hover:bg-purple-700">Back</button>
		</section>


		<!-- MULTIPLAYER VIEW -->
		<section id="multiplayer-view" class="view flex items-center justify-center min-h-screen pt-16">
			<!-- Multiplayer Form Container -->
			<div id="multiplayerFormContainer" class="w-full max-w-md mb-6">
				<h1 class="text-4xl font-bold mb-4 text-center">Multiplayer Pong</h1>
				<form id="multiplayerForm" class="w-full max-w-md">
					<div class="mb-4">
						<label for="player1" class="block text-lg mb-2">Player 1 Name</label>
						<input type="text" id="player1" name="player1" required class="w-full p-2 rounded text-black">
					</div>
					<div class="mb-4">
						<label for="player2" class="block text-lg mb-2">Player 2 Name</label>
						<input type="text" id="player2" name="player2" required class="w-full p-2 rounded text-black">
					</div>
					<button type="button" id="startMultiplayerGame"
						class="w-full py-3 text-xl bg-purple-600 rounded hover:bg-purple-700 transition-colors">
						Start Multiplayer Game
					</button>
				</form>
			</div>
			<!-- Multiplayer Game Container (initially hidden) -->
			<div id="multiplayerGameContainer" style="display: none;">
				<canvas id="pongMulti" width="800" height="600" class="mb-4"></canvas>
				<button onclick="location.href='#account'" class="px-4 py-2 bg-purple-600 rounded hover:bg-purple-700">
					Back
				</button>
			</div>
		</section>
<!-- Tournament Registration View -->
<section id="tournament-registration-view"
	class="view flex flex-col items-center justify-center min-h-screen pt-16 px-4">
	<h1 class="text-3xl font-bold mb-4 text-center">Tournament Registration</h1>
	<!-- User Search / Invite Interface -->
	<div class="mb-4 w-full max-w-md">
		<input id="user-search" type="text" placeholder="Search users to invite..." class="w-full p-2 border rounded">
		<!-- In a real implementation, as you type you would show results and allow selections -->
		<p class="text-sm mt-2 text-center">Type to search and select users</p>
	</div>
	<!-- Register Tournament Button -->
	<button type="button" onclick="registerTournament()"
		class="mt-2 w-full max-w-md px-4 py-2 bg-purple-600 rounded hover:bg-purple-700">
		Register Tournament
	</button>
</section>

<!-- Tournament Start View (initially hidden) -->
<section id="tournament-start-view" class="view flex flex-col items-center justify-center min-h-screen pt-16 px-4"
	style="display: none;">
	<h1 class="text-3xl font-bold mb-4 text-center">Tournament Ready</h1>
	<!-- Display the list of invited players -->
	<div class="mb-4 w-full max-w-md">
		<h2 class="text-xl font-semibold mb-2">Invited Players:</h2>
		<ul id="registered-users" class="list-disc pl-5"></ul>
	</div>
	<!-- Start Tournament Button -->
	<button type="button" onclick="startTournament()"
		class="w-full max-w-md px-4 py-2 bg-green-600 rounded hover:bg-green-700">
		Start Tournament Now
	</button>
</section>

		<footer class="absolute bottom-0 left-0 w-full p-4 bg-purple-500 text-center">
			<p class="text-sm text-purple-200">
				&copy; 2025 Team SAFARI, Inc. All rights reserved.
			</p>
		</footer>
		<!-- Basic SPA Routing Script -->
		<script>
		function showView(viewId) {
			document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
			const view = document.getElementById(viewId);
			if (view) view.classList.add('active');
		}
		function route() {
			const hash = window.location.hash.slice(1);
			switch(hash) {
				case 'account':
					showView('account-view');
					break;
				case 'createProfile':
					showView('createProfile-view');
					break;
				case 'editProfile':
					showView('editProfile-view');
					break;
				case 'singleplayer':
					showView('singleplayer-view');
					break;
				case 'multiplayer':
					showView('multiplayer-view');
					break;
				case 'tournament-start':
					showView('tournament-start-view');
					break;
				case 'tournament':
					showView('tournament-registration-view');
					break;
				case 'index':
				default:
					showView('index-view');
					break;
			}
		}

		window.addEventListener('hashchange', route);
		route();

		const startMultiBtn = document.getElementById('startMultiplayerGame');
		if (startMultiBtn) {
			startMultiBtn.addEventListener('click', async () => {
				const player1Name = document.getElementById('player1')?.value.trim();
				const player2Name = document.getElementById('player2')?.value.trim();
				if (player1Name && player2Name) {
					// Save names in localStorage (or pass them directly to your game module)
					localStorage.setItem('multiplayerPlayer1', player1Name);
					localStorage.setItem('multiplayerPlayer2', player2Name);

					const formContainer = document.getElementById('multiplayerFormContainer');
					const gameContainer = document.getElementById('multiplayerGameContainer');
					if (formContainer) formContainer.style.display = 'none';
					if (gameContainer) gameContainer.style.display = 'block';
				} else {
					alert('Please enter names for both players.');
				}
			});
		}

		function registerMulti() {
			var p1 = document.getElementById("player1").value.trim();
			var p2 = document.getElementById("player2").value.trim();
			if (!p1 || !p2) {
				alert("Please enter both names.");
				return;
			}
			localStorage.setItem("multiplayerPlayer1", p1);
			localStorage.setItem("multiplayerPlayer2", p2);
			// startMultiGame();
		}
		</script>
		<script src="multiplayer.js"></script>
		<script src="singleplayer.js"></script>
		<script src="tournament.js"></script>
		<script>
			    // Simulated registration call (replace with your actual fetch call)
					function registerTournament() {
						console.log("Register Tournament clicked");

						// Simulate backend call delay
						setTimeout(() => {
							// Simulated list of invited users; normally, this would be returned from your backend.
							const registeredUsers = ['Alice', 'Bob', 'Charlie'];

							// Populate the list in the tournament start view.
							const userListElement = document.getElementById('registered-users');
							userListElement.innerHTML = ''; // clear previous entries if any
							registeredUsers.forEach(user => {
								const li = document.createElement('li');
								li.textContent = user;
								userListElement.appendChild(li);
							});

							// Hide the registration view and show the start view.
							document.getElementById('tournament-registration-view').style.display = 'none';
							document.getElementById('tournament-start-view').style.display = 'flex';
						}, 1000); // 1 second delay to simulate fetch call
					}

					// Temporary function to simulate starting the tournament
					function startTournament() {
						console.log("Start Tournament Now clicked");
						// You can navigate to a tournament game page or perform additional logic here.
						alert("Tournament Started!");
					}
		</script>
	</body>
</html>
